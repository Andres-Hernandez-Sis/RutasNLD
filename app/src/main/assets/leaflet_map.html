<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Leaflet Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
            body{
                margin: 0;
                padding: 0;
            }
            #map{
                width: 100%;
                height: 100vh;
            }
            <!--linea que une los puntos-->
            .custom-location-marker {
            width: 20px;
            height: 20px;
            background-color: orange;
            border-radius: 30%;
            }
    </style>
</head>
<body>
<div id="map"></div>
<script type="text/javascript">
            // Esto sirve para deliminar el area de carga del mapa, en este caso, nuevo laredo.
            var southWest = L.latLng(27.400, -99.600);
            var northEast = L.latLng(27.550, -99.450);
            var bounds = L.latLngBounds(southWest, northEast);

            var map = L.map('map', {
                center: [27.46444,-99.52228],
                zoom: 13,
                maxBounds: bounds,
                detectRetina: true
            });

            var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
            var osmHOT = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png');

            osmLayer.addTo(map);
            osmHOT.addTo(map);

            var baseLayers = {
                "OpenStreetMapHT": osmHOT,
                "OpenStreetMap": osmLayer,
            };

            var markersLayer = L.layerGroup();

            var overlays = {
                "Marcadores": markersLayer
            };
            L.control.layers(baseLayers, overlays, { collapsed: true }).addTo(map);


            // Puntos X en el mapa
            L.marker([27.480925, -99.515360]).bindPopup('Punto Importante').addTo(markersLayer);
            L.marker([27.490000, -99.525000]).bindPopup('Punto Comercial').addTo(markersLayer);

            var customIconDestino = L.icon({
                iconUrl: 'icons/busicon.png', // Ruta de tu imagen personalizada
                iconSize: [40, 40], // Tamaño del ícono
                iconAnchor: [20, 40], // Punto de anclaje del ícono
                popupAnchor: [0, -40] // Punto de anclaje del popup
            });

            var destinationMarker = L.marker([27.4656252,-99.5492313], { draggable: true, icon: customIconDestino }).addTo(map);
            destinationMarker.bindPopup("Destino").openPopup();



            var circleRadius = 300; // Radio del círculo en metros
            // Círculo alrededor del marcador de destino
            var destinationCircle = L.circle(destinationMarker.getLatLng(), {
                color: 'orange',
                fillColor: '#f03',
                fillOpacity: 0.2,
                radius: circleRadius
            }).addTo(map);

            var initialPolyline

            var customIcon = L.icon({
                iconUrl: 'icons/currentlocationicon.png', // Ruta de tu imagen personalizada
                iconSize: [40, 40], // Tamaño del ícono
                iconAnchor: [20, 40], // Punto de anclaje del ícono
                popupAnchor: [0, -40] // Punto de anclaje del popup
            });





            <!--  OBTENER UBICACION-->

            var currentLocationMarker;
            function getLocationAndPassToJavaScript(lat, long) {
                console.log("Latitud:", lat);
                console.log("Longitud:", long);
                if (map) {
                    if (lat !== undefined && long !== undefined) {
                        map.setView([lat, long], 13);
                        if (currentLocationMarker) {
                            currentLocationMarker.setLatLng([lat, long]);
                        } else {
                            currentLocationMarker = L.marker([lat, long], { icon: customIcon }).bindPopup('Ubicacion Actual').addTo(map);
                        }

                        if (destinationMarker && currentLocationMarker) {
                            if (initialPolyline) {
                                map.removeLayer(initialPolyline);
                            }
                            initialPolyline = L.polyline([destinationMarker.getLatLng(), currentLocationMarker.getLatLng()], { color: 'orange' }).addTo(map);
                        }
                    }
                }
            }

            // Evento que se dispara cuando el usuario arrastra el marcador de destino
            destinationMarker.on('move', function (event) {
                var newDestinationLatLng = event.latlng;
                if (currentLocationMarker) {
                    if (initialPolyline) {
                        map.removeLayer(initialPolyline);
                    }
                    initialPolyline = L.polyline([newDestinationLatLng, currentLocationMarker.getLatLng()], { color: 'orange' }).addTo(map);
                    // Actualizar la posición del círculo alrededor del marcador de destino
                    destinationCircle.setLatLng(newDestinationLatLng);
                }
            });




        <!-- DECLARACION DE RUTAS -->
        // Agregando las rutas GeoJSON al mapa

        //MiradorPanteon
        var CoordenadasMiradorPanteon = { "type": "FeatureCollection", "features": [ { "type": "Feature", "properties": {}, "geometry": { "type": "LineString", "coordinates": [ [-99.51659494588012, 27.453516607544685], [-99.5153560997705, 27.455864761120353], [-99.51440353914472, 27.457752263050764], [-99.51205218488721, 27.46194099761854], [-99.50965354510409, 27.46651319091147], [-99.50808320475552, 27.469381850873333], [-99.50794250694493, 27.469762030089882], [-99.50774425093856, 27.469881190469835], [-99.5077506462936, 27.4697904016206], [-99.50672738948819, 27.46977337870308], [-99.50668708158803, 27.47481016762933], [-99.5037708122992, 27.474787468135332], [-99.50377794327497, 27.477816086562626], [-99.50372534592272, 27.478866583877462], [-99.50373174881763, 27.48382912622857], [-99.50378553056143, 27.4849515921631], [-99.50377610138241, 27.48658651749355], [-99.50373838242231, 27.487537487195226], [-99.50374600235924, 27.489355818728455], [-99.5034474499974, 27.489355085343632], [-99.50347888374898, 27.491465861939645], [-99.5035354641017, 27.492853790059016], [-99.50354489384192, 27.49381016420064], [-99.50507350299074, 27.493793141387286], [-99.50742150830708, 27.493837753396235], [-99.5098638167696, 27.493892010833676], [-99.50994868244285, 27.49524337437822], [-99.51017211328202, 27.4970680137115], [-99.50937372860989, 27.497165599554464], [-99.50890538484532, 27.497229727346962], [-99.508638208872, 27.497285490614445], [-99.50869164406707, 27.495922070624403], [-99.50869330511381, 27.495280565932205], [-99.50886022210663, 27.493883015143695], [-99.5099289259983, 27.493905321132203], [-99.51087229403964, 27.493913687550304], [-99.51404413445675, 27.493959290105536], [-99.51484566235318, 27.49397602124894], [-99.51580120936275, 27.493992750726605], [-99.51797032014332, 27.49412101122344], [-99.52094871659605, 27.49419350673601], [-99.52103987075148, 27.49427436569478], [-99.52103672750472, 27.494703753653184] ] } }, { "type": "Feature", "properties": {}, "geometry": { "type": "LineString", "coordinates": [ [-99.52103672750472, 27.494703753653184], [-99.5212284655558, 27.49482643561943], [-99.52374337691633, 27.494401837347468], [-99.52381567159135, 27.494385107931947], [-99.52390053925329, 27.494376743223285], [-99.52418874895969, 27.49442810916608], [-99.52490540921661, 27.494634438365665], [-99.5259426806414, 27.49502757806752], [-99.52708583461886, 27.49509065469931], [-99.52711107081129, 27.490540356215888], [-99.52715342611889, 27.489608842621493], [-99.52719941140393, 27.489268258785216], [-99.5272032694468, 27.488943124659002], [-99.52720575874818, 27.48667036722594], [-99.52698755689941, 27.485572431275187], [-99.52692674646686, 27.485013924075176], [-99.5269611648343, 27.48486782642169], [-99.52974848226638, 27.484217202281783], [-99.52975598702268, 27.479973423350373], [-99.52976434631647, 27.47997914369506], [-99.52976433557477, 27.479946272082785], [-99.53079496294252, 27.479937597206415], [-99.53172964109375, 27.479918949180473], [-99.5317372944101, 27.47893607689936], [-99.53178732144814, 27.477961518862102], [-99.53174403031872, 27.47700389046898], [-99.53177784010511, 27.474310672812592], [-99.53174411121175, 27.473404338627574], [-99.53175599256814, 27.472478397312628], [-99.52770355499722, 27.47246556856362], [-99.5277368952421, 27.468307218758213], [-99.5277621748006, 27.46794940701389], [-99.52940491194329, 27.46793725947387], [-99.53176357531525, 27.467939011152595], [-99.53183463044805, 27.46517402166988], [-99.53179908925087, 27.463721351054616], [-99.5317398637512, 27.462433078199965], [-99.53023069808634, 27.462435331823613], [-99.52984397852602, 27.462476924720875], [-99.52955491542056, 27.462625965803113], [-99.5294815069878, 27.462530660663376], [-99.52946105906425, 27.46246211777006], [-99.5296145123779, 27.46143463673259], [-99.5296093040589, 27.46133794571442], [-99.52916583418734, 27.45975781350178], [-99.52910755631638, 27.459688864155268], [-99.52888739547024, 27.459562456909225], [-99.52894135706165, 27.45937667626707], [-99.5290233777689, 27.459286658745697], [-99.52912567620612, 27.459154991322492], [-99.52953362130312, 27.458511458898414], [-99.53017131025085, 27.457358625176198], [-99.52654097868886, 27.455793069606173], [-99.5251510999563, 27.455082966870762], [-99.52127674414409, 27.45336223307119], [-99.52090864229768, 27.453169403132165], [-99.52068602102857, 27.452961173037266], [-99.52057771878978, 27.45275294255005], [-99.52015654341625, 27.451375407884328], [-99.51994565255893, 27.450724989101104], [-99.51980726636494, 27.450468700172365], [-99.5196508297978, 27.45029250118759], [-99.51943422531974, 27.450137659423902], [-99.51888068054325, 27.449860011579162], [-99.51868644900838, 27.449786125401786], [-99.5185913758682, 27.449982475717277], [-99.51830442784454, 27.450428864587977], [-99.51810113686405, 27.450785293484103], [-99.51798999046822, 27.45101124581022], [-99.51784133064847, 27.451356388783594], [-99.51778644406801, 27.45152207188154], [-99.51767235629926, 27.4516355851637], [-99.51659469082398, 27.453515883536596] ] } } ] };
        var geojsonCapaMiradorPanteon = L.geoJSON(CoordenadasMiradorPanteon, { style: { color: 'purple', weight: 5 }, onEachFeature: function (feature, layer) { layer.bindPopup('Ruta Mirador Panteon'); }});

        //MiradorReforma
        var CoordenadasMiradorReforma = {"type":"FeatureCollection","features":[{"type":"Feature","properties":{},"geometry":{"type":"LineString","coordinates":[[-99.51665898040699,27.453781615586806],[-99.51755163592003,27.452239041021002],[-99.51805669101277,27.451311401332916],[-99.51870269171324,27.44999810034321],[-99.51871329715506,27.44997860908893],[-99.51917859039582,27.45016719651423],[-99.5194783466188,27.45035181336614],[-99.51963269636256,27.45051062229051],[-99.51974454569903,27.45069523856752],[-99.52012706878071,27.451933946778468],[-99.5203239231229,27.452547340690984],[-99.52043353538373,27.45285502860503],[-99.52051630389262,27.45300787971472],[-99.52065052309686,27.453160730612595],[-99.52086080020702,27.45333740189986],[-99.52160571678992,27.453678833762652],[-99.52319397364164,27.45437161732012],[-99.52475091151798,27.455070351584467],[-99.52610876725056,27.455757175802788],[-99.52724739219938,27.4562613710647],[-99.52862308350261,27.45684501242016],[-99.5299697507869,27.457428604055096],[-99.52950221996898,27.458377429230936],[-99.52897876504024,27.45917141836624],[-99.52892283991714,27.459280591487882],[-99.52888481114235,27.45958230576285],[-99.52903021528024,27.459647809411237],[-99.5290950878957,27.45968750857284],[-99.52914430160364,27.459743087374775],[-99.52915548585156,27.459768892226066],[-99.52942839823292,27.46072563699397],[-99.52959393436986,27.461313178168155],[-99.5296051193035,27.461410439619343],[-99.52945995661214,27.46241075230928],[-99.52945771983703,27.462470299080493],[-99.52954048834593,27.462619167052353],[-99.52977089798011,27.462498087784354],[-99.53021605834002,27.462438540553805],[-99.53173496335114,27.462426634787292],[-99.53179216132074,27.463680338651614],[-99.53180558369078,27.464615215555497],[-99.53181005692949,27.46555802332989],[-99.53178544894227,27.466498839575763],[-99.53176481802424,27.466950241263845],[-99.53175363312664,27.467940665404072],[-99.53077159760956,27.467944634156808],[-99.52977166337745,27.46794066360782],[-99.52880976244126,27.467938677667874],[-99.52784562130753,27.46794066199797],[-99.5277650897846,27.467946616424825],[-99.52771387222138,27.46886320312028],[-99.52769933746534,27.469765928618642],[-99.52975600546218,27.4697594806308],[-99.52974873715064,27.47244826311345],[-99.52972693475523,27.476013860485367],[-99.52971966737742,27.477915900010274],[-99.52972693386023,27.478876571311645],[-99.52974146861587,27.48097198229479],[-99.52974873756945,27.48297708552431],[-99.52704527295585,27.48297063828454],[-99.52591882852714,27.482983536472787],[-99.525940630661,27.483963512493816],[-99.52588249163726,27.48502729238369],[-99.5259168345353,27.485055677277316],[-99.52611490473927,27.485053937532],[-99.52675422044669,27.48490779883545],[-99.52691110773692,27.484977388715564],[-99.52692713522835,27.485439589361206],[-99.52717339545289,27.486642199105674],[-99.52716622152911,27.487566949226817],[-99.52716861138182,27.488462472717742],[-99.52717578347915,27.488954531377743],[-99.52717100117351,27.4892472215773],[-99.52712079268822,27.489537790499227],[-99.52710930414854,27.489814389914216],[-99.52708539514009,27.490476118678217],[-99.52707344061041,27.49134778599982],[-99.52704079244418,27.493256642508243],[-99.52628646661921,27.49324070984966],[-99.525767868469,27.49324070923113],[-99.52470318823816,27.493223459529176],[-99.52383863284561,27.493202634318436],[-99.52090951657893,27.49317773904555],[-99.51763732226497,27.49313707878909],[-99.50986147758762,27.493017570158543],[-99.50984278411646,27.49386150152256],[-99.50988643092207,27.494523996379556],[-99.50993492737261,27.4952338078741],[-99.51002281178121,27.495952841399955],[-99.51009051741983,27.496465098280936],[-99.51015822305845,27.497069205055936],[-99.50951701083466,27.4971398606032],[-99.50864480611627,27.497288236534786],[-99.50866472171732,27.49676538530413],[-99.50868463761606,27.49604822720235],[-99.50868167530894,27.495333640886003],[-99.5087902681186,27.494394447829166],[-99.50884456452327,27.493768314673474],[-99.50896215844332,27.49219562118418],[-99.5090887986308,27.490205654511655],[-99.50922448224286,27.488520572266836],[-99.50984763223865,27.488526088444317],[-99.50984296577212,27.487631767645155],[-99.50980096059665,27.487126638154606],[-99.50976828963866,27.486567681141054],[-99.50976829009548,27.485967317976645],[-99.50879282862721,27.485967317976645],[-99.50764001194801,27.485959039039827],[-99.50482098261773,27.48594662005989],[-99.50378018795425,27.485959041288197],[-99.50271604817084,27.485938339007774],[-99.50273472082404,27.484940484394627],[-99.50274405663441,27.484381516999946],[-99.50279072943233,27.483921918874003],[-99.50280940215684,27.48335880433224],[-99.50273921270617,27.480924210523526],[-99.50275518178671,27.479915471970457],[-99.50276795721354,27.47890955670242],[-99.50279670246294,27.47788946551313],[-99.50280309022628,27.476866530293137],[-99.50280628418521,27.475820917174758],[-99.50474818344799,27.475818083605205],[-99.50572871740863,27.475826585403084],[-99.50669328085417,27.475815251699842],[-99.50771213917635,27.47582375267332],[-99.50773449095097,27.474829133170132],[-99.50773129714845,27.47383167316883],[-99.50772490910266,27.471802718212402],[-99.50774087865686,27.470966755516415],[-99.50789099199406,27.47043117082896],[-99.50797403373792,27.470314985116374],[-99.50797722765142,27.470212968292643],[-99.50793890069248,27.47013362180894],[-99.50797722765142,27.47005710907436],[-99.50799958523459,27.469912584591498],[-99.50835091569033,27.469246637300813],[-99.50883319522082,27.468342645931273],[-99.50985743361244,27.4664460617459],[-99.51027158098896,27.465861275351173],[-99.51079706119029,27.464912966010928],[-99.51139379388779,27.463743371530583],[-99.51200388534879,27.462700211361934]]}},{"type":"Feature","properties":{},"geometry":{"type":"LineString","coordinates":[[-99.51200485089738,27.462699811996842],[-99.51245255381085,27.461736926465946],[-99.51333011587147,27.460167003175258],[-99.51412982951379,27.458672415581674],[-99.51472430555913,27.45750436445455],[-99.5158212573783,27.45536290087034],[-99.51665845385081,27.453782093451053]]}}]};
        var geojsonCapaMiradorReforma = L.geoJSON(CoordenadasMiradorReforma, { style: { color: 'blue', weight: 5 }, onEachFeature: function (feature, layer) { layer.bindPopup('Ruta Mirador Reforma'); }});

        //Mina
<!--        var CoordenadasMina = {"type":"FeatureCollection","features":[{"type":"Feature","properties":{},"geometry":{"type":"LineString","coordinates":[[-99.50895863767163,27.492104992983613],[-99.51186835386265,27.492100669474524],[-99.5118172970438,27.493902411505005],[-99.52101233121263,27.494078129805644],[-99.5212111338693,27.494806115496488],[-99.5238759171978,27.494351684452283],[-99.52599617003011,27.49502299567763],[-99.53645065413342,27.49525349029834],[-99.53652245788497,27.4905249630053],[-99.5474376324369,27.49067923507272],[-99.55050407528663,27.49093041928805],[-99.55256571564496,27.49117644089972],[-99.55451560344173,27.49099485197793],[-99.55443818120209,27.49467239451984],[-99.56761783311944,27.495011510706277],[-99.565979519901,27.5011771408452],[-99.56538879191426,27.503207395824717],[-99.56563736063386,27.503298180320684],[-99.5656773058169,27.503800857630196],[-99.56880147345228,27.503774919329132],[-99.56879560359326,27.5100263825246],[-99.56525715475851,27.510035028134396],[-99.56516942462164,27.511539353897803],[-99.56888333373013,27.511556644878922],[-99.56891730384254,27.51547055408743],[-99.56472473179218,27.515531215170554],[-99.56475397517096,27.51693172501247]]},{"type":"Feature","properties":{},"geometry":{"type":"LineString","coordinates":[[-99.56222929680104,27.516879854594706],[-99.56232677473028,27.515470698911358],[-99.56889290188491,27.51553986015118],[-99.56894293532312,27.511536344557868],[-99.56521927842226,27.51157957200678],[-99.56519003504349,27.5100406643637],[-99.56887470077264,27.51003201875433],[-99.5688420179574,27.50375868976971],[-99.56537180367259,27.50379327417481],[-99.56530669319542,27.503216025050236],[-99.56395174997766,27.50319873275835],[-99.5641021360299,27.49871216752439],[-99.5643629717484,27.494896142016316],[-99.5544697598397,27.494699429501495],[-99.55451542227749,27.491931461475758],[-99.54129516396206,27.491688167510958],[-99.53654592847893,27.491385519584398],[-99.5364387027562,27.49336568185427],[-99.5165873904407,27.49306326432655],[-99.51185186130361,27.49306856624078],[-99.51185186130361,27.494555830285265],[-99.50876879506475,27.494539827918487],[-99.50891501195865,27.492153277846015]]}];-->
<!--          var geojsonCapaMina = L.geoJSON(CoordenadasMina, { style: { color: 'red', weight: 5 }, onEachFeature: function (feature, layer) { layer.bindPopup('Ruta Mina'); }});-->

        <!-- MARCAR LAS RUTAS -->

        destinationMarker.on('dragend', function () {
            var destinationLatLng = destinationMarker.getLatLng();
            var isOverlapping = L.geoJSON(CoordenadasMiradorPanteon).getBounds().contains(destinationLatLng);
            var isOverlapping2 = L.geoJSON(CoordenadasMiradorReforma).getBounds().contains(destinationLatLng);
<!--            var isOverlapping3 = L.geoJSON(CoordenadasMina).getBounds().contains(destinationLatLng);-->

            //En los 4 es lo mismo
            if (isOverlapping) {
                if (!map.hasLayer(geojsonCapaMiradorPanteon)) {
                    geojsonCapaMiradorPanteon.addTo(map);
                }
            } else if (map.hasLayer(geojsonCapaMiradorPanteon)) {
                map.removeLayer(geojsonCapaMiradorPanteon);
            }


            if (isOverlapping2) {
                if (!map.hasLayer(geojsonCapaMiradorReforma)) {
                    geojsonCapaMiradorReforma.addTo(map);
                }
            } else if (map.hasLayer(geojsonCapaMiradorReforma)) {
                map.removeLayer(geojsonCapaMiradorReforma);
            }


<!--            if (isOverlapping3) {-->
<!--                if (!map.hasLayer(geojsonCapaMina)) {-->
<!--                    geojsonCapaMina.addTo(map);-->
<!--                }-->
<!--            } else if (map.hasLayer(geojsonCapaMina)) {-->
<!--                map.removeLayer(geojsonCapaMina);-->
<!--            }-->

        });


</script>
</body>
</html>

