<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Leaflet Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
            body{
                margin: 0;
                padding: 0;
            }
            #map{
                width: 100%;
                height: 100vh;
            }
            <!--linea que une los puntos-->
            .custom-location-marker {
            width: 20px;
            height: 20px;
            background-color: orange;
            border-radius: 30%;
            }
    </style>
</head>
<body>
<div id="map"></div>
<script type="text/javascript">

            // Esto sirve para deliminar el area de carga del mapa, en este caso, nuevo laredo.
            var southWest = L.latLng(27.400, -99.600);
            var northEast = L.latLng(27.550, -99.450);
            var bounds = L.latLngBounds(southWest, northEast);

            var map = L.map('map', {
                center: [27.46444,-99.52228],
                zoom: 13,
                maxBounds: bounds,
                detectRetina: true
            });

            var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
            var osmHOT = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png');

            osmLayer.addTo(map);
            osmHOT.addTo(map);

            var baseLayers = {
                "OpenStreetMapHT": osmHOT,
                "OpenStreetMap": osmLayer,
            };

            var markersLayer = L.layerGroup();

            var overlays = {
                "Marcadores": markersLayer
            };
            L.control.layers(baseLayers, overlays, { collapsed: true }).addTo(map);


            // Puntos X en el mapa
            L.marker([27.480925, -99.515360]).bindPopup('Punto Importante').addTo(markersLayer);
            L.marker([27.490000, -99.525000]).bindPopup('Punto Comercial').addTo(markersLayer);

            var customIconDestino = L.icon({
                iconUrl: 'busicon.png', // Ruta de tu imagen personalizada
                iconSize: [40, 40], // Tamaño del ícono
                iconAnchor: [20, 40], // Punto de anclaje del ícono
                popupAnchor: [0, -40] // Punto de anclaje del popup
            });

            var destinationMarker = L.marker([27.4656252,-99.5492313], { draggable: true, icon: customIconDestino }).addTo(map);
            destinationMarker.bindPopup("Destino").openPopup();


            var circleRadius = 400; // Radio del círculo en metros
            // Círculo alrededor del marcador de destino
            var destinationCircle = L.circle(destinationMarker.getLatLng(), {
                color: 'orange',
                fillColor: '#f03',
                fillOpacity: 0.2,
                radius: circleRadius
            }).addTo(map);

            var initialPolyline

            var customIcon = L.icon({
                iconUrl: 'currentlocationicon.png', // Ruta de tu imagen personalizada
                iconSize: [40, 40], // Tamaño del ícono
                iconAnchor: [20, 40], // Punto de anclaje del ícono
                popupAnchor: [0, -40] // Punto de anclaje del popup
            });



            var currentLocationMarker;

            function getLocationAndPassToJavaScript(lat, long) {
                console.log("Latitud:", lat);
                console.log("Longitud:", long);
                if (map) {
                    if (lat !== undefined && long !== undefined) {
                        map.setView([lat, long], 13);
                        if (currentLocationMarker) {
                            currentLocationMarker.setLatLng([lat, long]);
                        } else {
                            currentLocationMarker = L.marker([lat, long], { icon: customIcon }).bindPopup('Ubicacion Actual').addTo(map);
                        }

                        if (destinationMarker && currentLocationMarker) {
                            if (initialPolyline) {
                                map.removeLayer(initialPolyline);
                            }
                            initialPolyline = L.polyline([destinationMarker.getLatLng(), currentLocationMarker.getLatLng()], { color: 'orange' }).addTo(map);
                        }
                    }
                }
            }

            // Evento que se dispara cuando el usuario arrastra el marcador de destino
            destinationMarker.on('move', function (event) {
                var newDestinationLatLng = event.latlng;
                if (currentLocationMarker) {
                    if (initialPolyline) {
                        map.removeLayer(initialPolyline);
                    }
                    initialPolyline = L.polyline([newDestinationLatLng, currentLocationMarker.getLatLng()], { color: 'orange' }).addTo(map);
                    // Actualizar la posición del círculo alrededor del marcador de destino
                    destinationCircle.setLatLng(newDestinationLatLng);
                }
            });

             // Agrega la ruta GeoJSON al mapa
        var geojsonFeature = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {},
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [
                            [
            -99.51659494588012,
            27.453516607544685
          ],
          [
            -99.5153560997705,
            27.455864761120353
          ],
          [
            -99.51440353914472,
            27.457752263050764
          ],
          [
            -99.51205218488721,
            27.46194099761854
          ],
          [
            -99.50965354510409,
            27.46651319091147
          ],
          [
            -99.50808320475552,
            27.469381850873333
          ],
          [
            -99.50794250694493,
            27.469762030089882
          ],
          [
            -99.50774425093856,
            27.469881190469835
          ],
          [
            -99.5077506462936,
            27.4697904016206
          ],
          [
            -99.50672738948819,
            27.46977337870308
          ],
          [
            -99.50668708158803,
            27.47481016762933
          ],
          [
            -99.5037708122992,
            27.474787468135332
          ],
          [
            -99.50377794327497,
            27.477816086562626
          ],
          [
            -99.50372534592272,
            27.478866583877462
          ],
          [
            -99.50373174881763,
            27.48382912622857
          ],
          [
            -99.50378553056143,
            27.4849515921631
          ],
          [
            -99.50377610138241,
            27.48658651749355
          ],
          [
            -99.50373838242231,
            27.487537487195226
          ],
          [
            -99.50374600235924,
            27.489355818728455
          ],
          [
            -99.5034474499974,
            27.489355085343632
          ],
          [
            -99.50347888374898,
            27.491465861939645
          ],
          [
            -99.5035354641017,
            27.492853790059016
          ],
          [
            -99.50354489384192,
            27.49381016420064
          ],
          [
            -99.50507350299074,
            27.493793141387286
          ],
          [
            -99.50742150830708,
            27.493837753396235
          ],
          [
            -99.5098638167696,
            27.493892010833676
          ],
          [
            -99.50994868244285,
            27.49524337437822
          ],
          [
            -99.51017211328202,
            27.4970680137115
          ],
          [
            -99.50937372860989,
            27.497165599554464
          ],
          [
            -99.50890538484532,
            27.497229727346962
          ],
          [
            -99.508638208872,
            27.497285490614445
          ],
          [
            -99.50869164406707,
            27.495922070624403
          ],
          [
            -99.50869330511381,
            27.495280565932205
          ],
          [
            -99.50886022210663,
            27.493883015143695
          ],
          [
            -99.5099289259983,
            27.493905321132203
          ],
          [
            -99.51087229403964,
            27.493913687550304
          ],
          [
            -99.51404413445675,
            27.493959290105536
          ],
          [
            -99.51484566235318,
            27.49397602124894
          ],
          [
            -99.51580120936275,
            27.493992750726605
          ],
          [
            -99.51797032014332,
            27.49412101122344
          ],
          [
            -99.52094871659605,
            27.49419350673601
          ],
          [
            -99.52103987075148,
            27.49427436569478
          ],
          [
            -99.52103672750472,
            27.494703753653184
          ],
          [
            -99.5212284655558,
            27.49482643561943
          ],
          [
            -99.52374337691633,
            27.494401837347468
          ],
          [
            -99.52381567159135,
            27.494385107931947
          ],
          [
            -99.52390053925329,
            27.494376743223285
          ],
          [
            -99.52418874895969,
            27.49442810916608
          ],
          [
            -99.52490540921661,
            27.494634438365665
          ],
          [
            -99.5259426806414,
            27.49502757806752
          ],
          [
            -99.52708583461886,
            27.49509065469931
          ],
          [
            -99.52711107081129,
            27.490540356215888
          ],
          [
            -99.52715342611889,
            27.489608842621493
          ],
          [
            -99.52719941140393,
            27.489268258785216
          ],
          [
            -99.5272032694468,
            27.488943124659002
          ],
          [
            -99.52720575874818,
            27.48667036722594
          ],
          [
            -99.52698755689941,
            27.485572431275187
          ],
          [
            -99.52692674646686,
            27.485013924075176
          ],
          [
            -99.5269611648343,
            27.48486782642169
          ],
          [
            -99.52974848226638,
            27.484217202281783
          ],
          [
            -99.52975598702268,
            27.479973423350373
          ],
          [
            -99.52976434631647,
            27.47997914369506
          ],
          [
            -99.52976433557477,
            27.479946272082785
          ],
          [
            -99.53079496294252,
            27.479937597206415
          ],
          [
            -99.53172964109375,
            27.479918949180473
          ],
          [
            -99.5317372944101,
            27.47893607689936
          ],
          [
            -99.53178732144814,
            27.477961518862102
          ],
          [
            -99.53174403031872,
            27.47700389046898
          ],
          [
            -99.53177784010511,
            27.474310672812592
          ],
          [
            -99.53174411121175,
            27.473404338627574
          ],
          [
            -99.53175599256814,
            27.472478397312628
          ],
          [
            -99.52770355499722,
            27.47246556856362
          ],
          [
            -99.5277368952421,
            27.468307218758213
          ],
          [
            -99.5277621748006,
            27.46794940701389
          ],
          [
            -99.52940491194329,
            27.46793725947387
          ],
          [
            -99.53176357531525,
            27.467939011152595
          ],
          [
            -99.53183463044805,
            27.46517402166988
          ],
          [
            -99.53179908925087,
            27.463721351054616
          ],
          [
            -99.5317398637512,
            27.462433078199965
          ],
          [
            -99.53023069808634,
            27.462435331823613
          ],
          [
            -99.52984397852602,
            27.462476924720875
          ],
          [
            -99.52955491542056,
            27.462625965803113
          ],
          [
            -99.5294815069878,
            27.462530660663376
          ],
          [
            -99.52946105906425,
            27.46246211777006
          ],
          [
            -99.5296145123779,
            27.46143463673259
          ],
          [
            -99.5296093040589,
            27.46133794571442
          ],
          [
            -99.52916583418734,
            27.45975781350178
          ],
          [
            -99.52910755631638,
            27.459688864155268
          ],
          [
            -99.52888739547024,
            27.459562456909225
          ],
          [
            -99.52894135706165,
            27.45937667626707
          ],
          [
            -99.5290233777689,
            27.459286658745697
          ],
          [
            -99.52912567620612,
            27.459154991322492
          ],
          [
            -99.52953362130312,
            27.458511458898414
          ],
          [
            -99.53017131025085,
            27.457358625176198
          ],
          [
            -99.52654097868886,
            27.455793069606173
          ],
          [
            -99.5251510999563,
            27.455082966870762
          ],
          [
            -99.52127674414409,
            27.45336223307119
          ],
          [
            -99.52090864229768,
            27.453169403132165
          ],
          [
            -99.52068602102857,
            27.452961173037266
          ],
          [
            -99.52057771878978,
            27.45275294255005
          ],
          [
            -99.52015654341625,
            27.451375407884328
          ],
          [
            -99.51994565255893,
            27.450724989101104
          ],
          [
            -99.51980726636494,
            27.450468700172365
          ],
          [
            -99.5196508297978,
            27.45029250118759
          ],
          [
            -99.51943422531974,
            27.450137659423902
          ],
          [
            -99.51888068054325,
            27.449860011579162
          ],
          [
            -99.51868644900838,
            27.449786125401786
          ],
          [
            -99.5185913758682,
            27.449982475717277
          ],
          [
            -99.51830442784454,
            27.450428864587977
          ],
          [
            -99.51810113686405,
            27.450785293484103
          ],
          [
            -99.51798999046822,
            27.45101124581022
          ],
          [
            -99.51784133064847,
            27.451356388783594
          ],
          [
            -99.51778644406801,
            27.45152207188154
          ],
          [
            -99.51767235629926,
            27.4516355851637
          ],
          [
            -99.51659469082398,
            27.453515883536596
          ]
                        ]
                    }
                }
            ]
        };
        L.geoJSON(geojsonFeature, { color: 'purple', weight: 5 }).bindPopup('Ruta Mirador Panteon').addTo(map);
</script>
</body>
</html>

